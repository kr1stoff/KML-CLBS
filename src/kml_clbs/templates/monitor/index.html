{% extends 'index.html' %} {% block title %}{{title}}{% endblock %} {% block
header%}{% endblock %} {% block content %}

<!-- Main content -->
<main class="flex-grow-1 p-4" style="height: 80vh; overflow: auto">
  <h2>{{ title }}</h2>
  <hr />

  <!-- 统计卡片 -->
  <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
    <div class="col">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">总访问次数</h5>
          <p class="card-text display-4 fw-bold text-primary">
            {{ total_visits }}
          </p>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">唯一IP数量</h5>
          <p class="card-text display-4 fw-bold text-success">
            {{ unique_ips }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- 按路径分组的访问次数 -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">按路径访问统计</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th scope="col">路径</th>
              <th scope="col">访问次数</th>
            </tr>
          </thead>
          <tbody>
            {% for item in visits_by_path %}
            <tr>
              <td>{{ item.path }}</td>
              <td>{{ item.count }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 按天分组的访问次数 -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">按天访问统计</h5>
    </div>
    <div class="card-body">
      <div class="chart-container" style="position: relative; height: 300px">
        <canvas id="visitsByDayChart"></canvas>
      </div>
    </div>
  </div>

  <!-- 按小时分组的访问次数 -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">按小时访问统计</h5>
    </div>
    <div class="card-body">
      <div class="chart-container" style="position: relative; height: 300px">
        <canvas id="visitsByHourChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    // 按天访问统计图表
    const dayLabels = {{ visits_by_day | map(attribute='day') | list | tojson }};
    const dayCounts = {{ visits_by_day | map(attribute='count') | list | tojson }};

    const dayCtx = document.getElementById('visitsByDayChart').getContext('2d');
    new Chart(dayCtx, {
      type: 'line',
      data: {
        labels: dayLabels,
        datasets: [{
          label: '访问次数',
          data: dayCounts,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          tension: 0.1,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // 按小时访问统计图表
    const hourLabels = {{ visits_by_hour | map(attribute='hour') | list | tojson }};
    const hourCounts = {{ visits_by_hour | map(attribute='count') | list | tojson }};

    const hourCtx = document.getElementById('visitsByHourChart').getContext('2d');
    new Chart(hourCtx, {
      type: 'bar',
      data: {
        labels: hourLabels,
        datasets: [{
          label: '访问次数',
          data: hourCounts,
          backgroundColor: 'rgba(153, 102, 255, 0.6)',
          borderColor: 'rgba(153, 102, 255, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true
          },
          x: {
            title: {
              display: true,
              text: '小时'
            }
          }
        }
      }
    });
  </script>
</main>

{% endblock %}
